@model WebTIGA.Models.ContenedorModelos

@{
    ViewBag.Title = "ScriptDetail";
    Layout = "~/Views/Shared/_Layout_Auditoria_Continua.cshtml";
    string Btn1 = "", btn2 = "btn btn-warning", btn3 = "btn btn-danger", btn4 = "";

}


<html>
<head>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    <title>DataTables example - HTML5 export buttons</title>
    <link rel="shortcut icon" type="image/png" href="/media/images/favicon.png">
    <link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="http://www.datatables.net/rss.xml">
    <link rel="stylesheet" type="text/css" href="/media/css/site-examples.css?_=19472395a2969da78c8a4c707e72123a">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.19/css/jquery.dataTables.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/buttons/1.5.2/css/buttons.dataTables.min.css">

    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstr apcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <script src="https://unpkg.com/gijgo@1.9.13/js/gijgo.min.js" type="text/javascript"></script>
    <link href="https://unpkg.com/gijgo@1.9.13/css/gijgo.min.css" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.0/css/all.css" integrity="sha384-lZN37f5QGtY3VHgisS14W3ExzMWZxybE1SJSEsQp9S+oqd12jhcu+A56Ebc1zFSJ" crossorigin="anonymous">



    <script type="text/javascript" async="" src="https://ssl.google-analytics.com/ga.js"></script>
    <script type="text/javascript" src="/media/js/site.js?_=5e8f232afab336abc1a1b65046a73460"></script>
    <script type="text/javascript" src="/media/js/dynamic.php?comments-page=extensions%2Fbuttons%2Fexamples%2Fhtml5%2Fsimple.html" async=""></script>
    <script type="text/javascript" language="javascript" src="https://code.jquery.com/jquery-3.3.1.js"></script>
    <script type="text/javascript" language="javascript" src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>
    <script type="text/javascript" language="javascript" src="https://cdn.datatables.net/buttons/1.5.2/js/dataTables.buttons.min.js"></script>
    <script type="text/javascript" language="javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
    <script type="text/javascript" language="javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.36/pdfmake.min.js"></script>
    <script type="text/javascript" language="javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.36/vfs_fonts.js"></script>
    <script type="text/javascript" language="javascript" src="https://cdn.datatables.net/buttons/1.5.2/js/buttons.html5.min.js"></script>
    <script type="text/javascript" language="javascript" src="../../../../examples/resources/demo.js"></script>
    <script type="text/javascript" class="init">
        $(document).ready(function () {
            $('#example').DataTable({
                dom: 'Bfrtip',
                buttons: [
                    'excelHtml5',
                ]
            });
        });
    </script>



</head>
<body>
    <div class="row">

        <div class="col-lg-12">
            <div class="card text-white bg-secondary mb-3">
                <div class="card-header"><strong>@ViewBag.NombreScript</strong>@Html.ActionLink("Regresar", "AdministrarScript", new { }, new { @class = "btn btn-info ", @style = "float: right;" })</div>
                <div class="card-body">


                </div>
            </div>

        </div>


    </div>
    <div class="row">
        <div class="col-lg-12">


            <div class="card ">
                <div class="card-header">
                    <strong class="card-title">Gráficas Power BI</strong>
                </div>
                <div class="col-sm-12">
                    <div class="card-body">
                        <div class="col-sm-12">

                            <div class="text-center">
                               
                                <iframe width="1300" height="800" src=@ViewBag.graficaPowerBI frameborder="0" allowFullScreen="true"></iframe>

                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>

    </div>
    </br>


    <div class="card shadow mb-4">
        <div class="card-header py-3">
            <h6 class="m-0 font-weight-bold text-dark">Reportes del Script : @ViewBag.NombreScript</h6>

        </div>
        <div class="card-body">
            @using (Html.BeginForm("ScriptDetail", "WebAuditoriaContinua", FormMethod.Post, new { enctype = "multipart/form-data" }))
            {


                <div class="col-lg-12 center-block">
                    <div class="card">
                        <div class="card-header" style="background-color: cadetblue;color: white;">
                            <strong>Archivos Adjuntos </strong>
                        </div>
                        <div class="card-body card-block">
                            <div class="container" style="text-align:center;">
                                <div>

                                    <input class="input-file" id="my-file" type="file" name="postedFile" accept="image/*,.pdf,.xlsx,.xls" required="required">
                                    <label tabindex="0" for="my-file" class="input-file-trigger">Subir Archivo...</label>
                                    <p class="file-return"></p>
                                    <a><strong> (max 3 mb) </strong></a>

                                    <input type="hidden" id="IdItem" name="IdItem" value=Model.DAC_ScriptsContinua.ID />
                                    <input type="submit" id="btnUpload" value="Subir" class="btn btn-warning" style="width: 80px;" />
                               
                                </div>
                            </div>




                            <hr />
                            <div class="row">
                                <div class="col-lg-12">
                                    <div class="table-responsive">
                                        <table class="table table-bordered table-hover table-striped">
                                            <tr>
                                                <th style="text-align:center; width:50px">ID</th>
                                                <th style="text-align:center">Nombre de Archivo</th>
                                                <th style="text-align:center">Fecha de Carga</th>
                                                <th style="@Btn1">Operaciones</th>
                                            </tr>
                                            @if (Model.DAC_HistorialReportesScript.Count() > 0)
                                            {

                                                foreach (var file in Model.DAC_HistorialReportesScript)
                                                {
                                                    if (file.idScript == ViewBag.IDScript)
                                                    {
                                                        <tr>
                                                            <td style="text-align:center;">@file.idScript</td>
                                                            <td style="text-align:center;">@file.nombreArchivo</td>
                                                            <td style="text-align:center;">@file.fechaModificacion</td>
                                                            <td style="@btn4">
                                                                <button type="button" href="javascript:;" onclick="DownloadFile(@file.idHistorialReporte)" class="@btn2">Descargar</button> |
                                                                <button type="button" href="javascript:;" onclick="DeleteFile(@file.idHistorialReporte)" class="@btn3">Eliminar</button>
                                                        </tr>
                                                    }

                                                }
                                            }
                                            else
                                            {
                                                <tr>
                                                    <td colspan="3" style="text-align: center;">&nbsp;No hay Archivos Adjuntos...</td>
                                                </tr>
                                            }
                                        </table>
                                    </div>
                                </div>
                            </div>


                        </div>
                    </div>
                </div>

            }


        </div>
        <div class="row">
            <div class="col-lg-4">
                @using (Html.BeginForm("DownloadFileReport", "WebAuditoriaContinua", FormMethod.Post))
                {
                    <input type="hidden" id="hfFileId" name="fileId" />
                    <input type="submit" id="btnDownload" value="Descargar" style="display:none" />
                }
            </div>
            <div class="col-lg-4">
                @using (Html.BeginForm("DeleteFileReport", "WebAuditoriaContinua", FormMethod.Post))
                {
                    <input type="hidden" id="VIdItem2" name="IdItem" required="required" value=@ViewBag.IDScript />
                    <input type="hidden" id="hfFileId2" name="fileId" />
                    <input type="submit" id="btnDelete" value="Eliminar" style="display:none" />
                }
            </div>
        </div>

    </div>

</body>
</html>



<script src="~/Scripts/jquery-3.3.1.min.js"></script>
<script type="text/javascript">
    function DownloadFile(fileId) {
        $("#hfFileId").val(fileId);
        $("#btnDownload")[0].click();
    };
    function DeleteFile(fileId) {
        $("#hfFileId2").val(fileId);
        $("#btnDelete")[0].click();
    };
    $(function () {
        $('.input-xlarge').change(function () {
            var selectedval = $(this).val();
            $('.control-label').text(selectedval + " Station");
        });
    });
</script>
<script src="~/Adjunto_Documentos/js/index.js"></script>


<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script type="text/javascript">

            google.charts.load('current', {'packages':['table']});
            google.charts.setOnLoadCallback(drawTable);
    function drawTable() {
        var dataJson;

        $.ajax({

            url: '@Url.Action("MostrarScripts")', // to get the right path to controller from TableRoutes of Asp.Net MVC
            dataType: "json", //to work with json format
            type: "POST", //to do a post request
            contentType: 'application/json; charset=utf-8', //define a contentType of your request
            cache: false, //avoid caching results
            data: {}, // here you can pass arguments to your request if you need
            success: function (dataJson) {
                var arrOutside = new Array();

              // var heading = ["ID","FECDOCOTR", "CODMONEDA"];
             //   arrOutside[0] = heading;
                if (dataJson.length > 0) {
                    console.log(dataJson);
                    console.log(dataJson[0]);
                   for (var x=0;x<4;x++) {
                       var a = Object.keys(dataJson[x]);
                       var arr2 = Object.values(dataJson[x]);

                       var arr = arr2.slice(0, 3);
                       var arr1 = a.slice(0, 3);
                       arrOutside[0] = arr1
                          arrOutside[x+1] = arr;



                    }

                    //for (var i = 0; i < dataJson.length; i++) {
                    //    var arr = [dataJson[i].ID, dataJson[i].CODMONEDA];

                    //    arrOutside[i + 1] = arr;
                    //}
                       console.log(arrOutside);
                    var gdata = new google.visualization.arrayToDataTable(arrOutside);
                    //var gdata = new google.visualization.DataTable(arrOutside);

                    var table = new google.visualization.Table(document.getElementById('table_div'));
                    table.draw(gdata, {showRowNumber: true, width: '100%', height: '100%'});
                    $(window).resize(function () {
                        drawTable();
                    });
                }
                },
                error: function (xhr) {
                    //alert('error' + xhr[0]);
                }

            });

            };
</script>
