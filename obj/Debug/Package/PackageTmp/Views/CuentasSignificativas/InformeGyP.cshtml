@using WebTIGA;

@model WebTIGA.Models.ContenedorModelos
@{
    ViewBag.Title = "InformeGyP";
    Layout = "~/Views/Shared/_Layout_CuentasSIG.cshtml";

    var listaGYP = Model.SP_BC_GYP_INFORME.ToList();

    var subtotRT1 = 0.0; var subtotRT2 = 0.0; var subtotRT3 = 0.0;
    var subtotRO1 = 0.0; var subtotRO2 = 0.0; var subtotRO3 = 0.0;
    var subtotUN1 = 0.0; var subtotUN2 = 0.0; var subtotUN3 = 0.0; 
}

<div class="card shadow">
    <div class="card-header py-3 text-center">
        <h6 class="m-0 font-weight-bold">Informe de Ganancias y Pérdidas</h6>
        <small class="m-0 font-italic">Expresado en millones de soles</small>
    </div>
    <div class="card-body">
        @using (Html.BeginForm())
        {
            <div class="row justify-content-center">
                <div class="col-lg-3">
                    Error Tolerable: <br />
                    @Html.TextBox("errorTolerable", null, new { style = "text-transform:uppercase", @class = "form-control", placeholder = ViewBag.ErrorTolerable, @type = "number" })
                </div>

                <div class="col-lg-3">
                    Periodo: <br />
                    @Html.DropDownList("periodo", null, htmlAttributes: new { @class = "form-control" })
                </div>
                <div class="col-lg-2">
                    <br />
                    <button type="submit" class="btn btn-info">
                        <i class="fas fa-search"></i> Buscar
                    </button>
                </div>
            </div>
        }


        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-sm table-bordered" id="informe-GYP" width="100%" style="font-size: 0.85rem;">
                    <thead class="table-active">
                        <tr>
                            <th class="text-center align-middle" style="width: 20%"> Rubro </th>
                            <th class="text-center align-middle" style="width: 10%"> @ViewBag.NombreMes </th>
                            <th class="text-center align-middle" style="width: 10%"> @ViewBag.NombreMesAnterior </th>
                            <th class="text-center align-middle" style="width: 10%"> Variación </th>
                            <th class="text-center align-middle" style="width: 10%"> Acumulado @ViewBag.NombreMes </th>
                            <th class="text-center align-middle" style="width: 10%"> Proyectado a Diciembre </th>
                            <th class="text-center align-middle" style="width: 10%"> Alcance Metodología </th>
                            <th class="text-center align-middle" style="width: 10%"> Significativas Seleccionadas </th>
                            <th class="text-center align-middle" style="width: 10%"> Alcance Seleccionadas </th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var item in listaGYP)
                        {
                            if (item.TIPO == "Técnico")
                            {
                            <tr>
                                <td class="text-left">@item.RUBRO</td>
                                <td class="text-right">@item.MES</td>
                                <td class="text-right">@item.MES_ANTERIOR</td>
                                <td class="text-right">@item.VARIACION</td>
                                <td class="text-right">@item.ACUMULADO_MES</td>
                                <td class="text-right">@item.PROYECTADO_DICIEMBRE</td>
                                <td class="text-right">@item.ALCANCE_METODOLOGIA </td>
                                <td class="text-right">@item.SIGNIFICATIVAS_SELECCIONADAS</td>
                                <td class="text-center">@item.ALCANCE_SELECCIONADAS</td>
                            </tr>
                                subtotRT1 += (item.MES == null ? 0 : (double)item.MES);
                                subtotRT2 += (item.MES_ANTERIOR == null ? 0 : (double)item.MES_ANTERIOR);
                                subtotRT3 += (item.ACUMULADO_MES == null ? 0 : (double)item.ACUMULADO_MES);
                            }
                        }
                    <tr class="font-weight-bold">
                        <td class="text-center table-active">Resultado Técnico</td>
                        <td class="text-right table-active">@Math.Round(subtotRT1, 1)</td>
                        <td class="text-right table-active">@Math.Round(subtotRT2, 1)</td>
                        <td class="text-right table-active">@Math.Round((subtotRT1 - subtotRT2), 1)</td>
                        <td class="text-right table-active">@Math.Round(subtotRT3, 1)</td>
                        <td class="text-right table-active"></td>
                        <td class="text-right table-active"></td>
                        <td class="text-right table-active"></td>
                        <td class="text-right table-active"></td>
                    </tr>
                        @foreach (var item in listaGYP)
                        {
                            if (item.TIPO == "Operativo")
                            {
                                <tr>
                                    <td style="text-align:left">@item.RUBRO</td>
                                    <td style="text-align:right">@item.MES</td>
                                    <td style="text-align:right">@item.MES_ANTERIOR</td>
                                    <td style="text-align:right">@item.VARIACION</td>
                                    <td style="text-align:right">@item.ACUMULADO_MES</td>
                                    <td style="text-align:right">@item.PROYECTADO_DICIEMBRE</td>
                                    <td style="text-align:right">@item.ALCANCE_METODOLOGIA </td>
                                    <td style="text-align:right">@item.SIGNIFICATIVAS_SELECCIONADAS</td>
                                    <td style="text-align:center">@item.ALCANCE_SELECCIONADAS</td>
                                </tr>
                                subtotRO1 += (item.MES == null ? 0 : (double)item.MES);
                                subtotRO2 += (item.MES_ANTERIOR == null ? 0 : (double)item.MES_ANTERIOR);
                                subtotRO3 += (item.ACUMULADO_MES == null ? 0 : (double)item.ACUMULADO_MES);
                            }
                        }
                        <tr class="font-weight-bold">
                            <td class="text-center table-active">Resultado Operativo</td>
                            <td class="text-right table-active">@Math.Round((subtotRO1+subtotRT1), 1)</td>
                            <td class="text-right table-active">@Math.Round((subtotRO2+subtotRT2), 1)</td>
                            <td class="text-right table-active">@Math.Round(((subtotRO1 + subtotRT1)-(subtotRO2 + subtotRT2)), 1)</td>
                            <td class="text-right table-active">@Math.Round((subtotRO3+subtotRT3), 1)</td>
                            <td class="text-right table-active"></td>
                            <td class="text-right table-active"></td>
                            <td class="text-right table-active"></td>
                            <td class="text-right table-active"></td>
                        </tr>
                        @foreach (var item in listaGYP)
                        {
                            if (item.TIPO == "Utilidad Neta PGA antes de PC")
                            {
                                <tr>
                                    <td style="text-align:left">@item.RUBRO</td>
                                    <td style="text-align:right">@item.MES</td>
                                    <td style="text-align:right">@item.MES_ANTERIOR</td>
                                    <td style="text-align:right">@item.VARIACION</td>
                                    <td style="text-align:right">@item.ACUMULADO_MES</td>
                                    <td style="text-align:right">@item.PROYECTADO_DICIEMBRE</td>
                                    <td style="text-align:right">@item.ALCANCE_METODOLOGIA </td>
                                    <td style="text-align:right">@item.SIGNIFICATIVAS_SELECCIONADAS</td>
                                    <td style="text-align:center">@item.ALCANCE_SELECCIONADAS</td>
                                </tr>
                                subtotUN1 += (item.MES == null ? 0 : (double)item.MES);
                                subtotUN2 += (item.MES_ANTERIOR == null ? 0 : (double)item.MES_ANTERIOR);
                                subtotUN3 += (item.ACUMULADO_MES == null ? 0 : (double)item.ACUMULADO_MES);
                            }
                        }
                        <tr class="font-weight-bold">
                            <td class="text-center table-active">Utilidad Neta</td>
                            <td class="text-right table-active">@Math.Round((subtotUN1 + subtotRO1 + subtotRT1), 1)</td>
                            <td class="text-right table-active">@Math.Round((subtotUN2 + subtotRO2 + subtotRT2), 1)</td>
                            <td class="text-right table-active">@Math.Round(((subtotUN1 + subtotRO1 + subtotRT1) - (subtotUN2 + subtotRO2 + subtotRT2)), 1)</td>
                            <td class="text-right table-active">@Math.Round((subtotUN3 + subtotRO3 + subtotRT3), 1)</td>
                            <td class="text-right table-active"></td>
                            <td class="text-right table-active"></td>
                            <td class="text-right table-active"></td>
                            <td class="text-right table-active"></td>
                        </tr>
                    </tbody>

                </table>
            </div>

        </div>
    </div>
</div>

<script type="text/javascript" class="init">
    $(document).ready(function () {
        $('#informe-GYP').DataTable({
            dom: 'Bfrtip',
            buttons: [
                { extend: 'excelHtml5', text: '<i class="fas fa-file-excel"></i> Descargar Excel' },
            ],
            "scrollY": "49vh",
            ordering: false,
            searching: false,
            paging: false,
            info: false
        });
    });
</script>

